// Prisma Schema - RuleTheWorld
// TÃ¼rkÃ§e model ve alan isimleri

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============ OYUNCULAR ============

model Oyuncu {
  id            String   @id @default(uuid())
  kullaniciAdi  String   @unique
  email         String   @unique
  sifreHash     String

  // Email dogrulama
  emailDogrulandi   Boolean  @default(false)

  // 2FA (Ä°ki FaktÃ¶rlÃ¼ DoÄŸrulama)
  ikiFactorAktif    Boolean  @default(false)
  ikiFactorSecret   String?  // TOTP secret key
  ikiFactorYedekKodlar String? // JSON array of backup codes

  // Rol ve durum
  sistemRolu    SistemRolu   @default(KULLANICI)
  hesapDurumu   HesapDurumu  @default(AKTIF)
  banSebebi     String?
  banBitisi     DateTime?

  // Ä°statistikler
  oynananOyunlar    Int      @default(0)
  tamamlananOyunlar Int      @default(0)
  yapilanOneriler   Int      @default(0)
  verilenOylar      Int      @default(0)

  // Zaman damgalarÄ±
  olusturuldu   DateTime @default(now())
  guncellendi   DateTime @updatedAt
  sonAktiflik   DateTime @default(now())

  // Skor ve sÄ±ralama
  toplamPuan        Int      @default(0)
  sezonPuani        Int      @default(0)
  haftalikPuan      Int      @default(0)

  // Bot Ã¶zellikleri
  botMu             Boolean  @default(false)
  botKisilik        String?  // DENGELI, EKONOMIST, POPULIST, vb.

  // Ä°liÅŸkiler
  uyelikler             ToplulukUyesi[]
  oneriler              Oneri[]
  oylar                 Oy[]
  mesajlar              Mesaj[]
  bildirimler           Bildirim[]
  yenilemeTokenlari     YenilemeToken[]
  sifreSifirlamalari    SifreSifirlama[]
  alinanBanlar          Ban[]            @relation("BanlananOyuncu")
  verilenBanlar         Ban[]            @relation("BanlayanYetkili")
  moderasyonAksiyonlari Moderasyon[]
  basarimlar            KazanilanBasarim[]
  turnuvaKatilimlari    TurnuvaKatilimci[]
  emailDogrulamalari    EmailDogrulama[]
  gonderilenArkadasliklar Arkadaslik[]   @relation("GonderenOyuncu")
  alinanArkadasliklar     Arkadaslik[]   @relation("AlanOyuncu")
  premiumUyelikler        PremiumUyelik[]
  mesajReaksiyonlari      MesajReaksiyon[]

  @@index([sistemRolu])
  @@index([hesapDurumu])
  @@map("oyuncular")
}

// Ban geÃ§miÅŸi
model Ban {
  id            String      @id @default(uuid())
  oyuncuId      String
  yetkiliId     String
  sebep         String
  tip           BanTipi     @default(GECICI)
  baslangic     DateTime    @default(now())
  bitis         DateTime?
  iptalEdildi   Boolean     @default(false)
  iptalSebebi   String?

  oyuncu        Oyuncu      @relation("BanlananOyuncu", fields: [oyuncuId], references: [id])
  yetkili       Oyuncu      @relation("BanlayanYetkili", fields: [yetkiliId], references: [id])

  @@index([oyuncuId])
  @@index([yetkiliId])
  @@map("banlar")
}

// Moderasyon loglarÄ±
model Moderasyon {
  id            String          @id @default(uuid())
  yetkiliId     String
  aksiyon       ModeasyonTipi
  hedefTip      String          // "oyuncu", "topluluk", "mesaj"
  hedefId       String
  detay         Json?
  olusturuldu   DateTime        @default(now())

  yetkili       Oyuncu          @relation(fields: [yetkiliId], references: [id])

  @@index([yetkiliId])
  @@index([hedefTip, hedefId])
  @@map("moderasyon_loglari")
}

model YenilemeToken {
  id          String    @id @default(uuid())
  oyuncuId    String
  tokenHash   String    @unique
  sonlanma    DateTime
  olusturuldu DateTime  @default(now())
  iptalEdildi DateTime?

  oyuncu      Oyuncu    @relation(fields: [oyuncuId], references: [id], onDelete: Cascade)

  @@index([oyuncuId])
  @@index([sonlanma])
  @@map("yenileme_tokenlari")
}

model SifreSifirlama {
  id          String    @id @default(uuid())
  oyuncuId    String
  tokenHash   String    @unique
  sonlanma    DateTime
  kullanildi  Boolean   @default(false)
  olusturuldu DateTime  @default(now())

  oyuncu      Oyuncu    @relation(fields: [oyuncuId], references: [id], onDelete: Cascade)

  @@index([oyuncuId])
  @@index([sonlanma])
  @@map("sifre_sifirlamalari")
}

// Email dogrulama tokenlari
model EmailDogrulama {
  id          String    @id @default(uuid())
  oyuncuId    String
  tokenHash   String    @unique
  sonlanma    DateTime
  kullanildi  Boolean   @default(false)
  olusturuldu DateTime  @default(now())

  oyuncu      Oyuncu    @relation(fields: [oyuncuId], references: [id], onDelete: Cascade)

  @@index([oyuncuId])
  @@index([sonlanma])
  @@map("email_dogrulamalari")
}

// ============ TOPLULUKLAR ============

model Topluluk {
  id          String          @id @default(uuid())
  isim        String
  durum       ToplulukDurumu  @default(LOBI)
  maxOyuncu   Int             @default(8)
  minOyuncu   Int             @default(4)
  gizliMi     Boolean         @default(false)
  davetKodu   String?         @unique
  kurucuId    String

  // Oyun modu ayarlarÄ±
  oyunModu        OyunModu    @default(NORMAL)
  turSuresi       Int         @default(120)    // saniye cinsinden (varsayÄ±lan 2 dk)
  toplamTurSayisi Int         @default(6)
  botDoldur       Boolean     @default(false)  // Eksik oyuncularÄ± bot ile doldur

  olusturuldu DateTime        @default(now())
  guncellendi DateTime        @updatedAt
  basladiAt   DateTime?
  bittiAt     DateTime?

  // Ä°liÅŸkiler
  uyeler      ToplulukUyesi[]
  oyunDurumu  OyunDurumu?
  turlar      Tur[]
  mesajlar    Mesaj[]
  oyunOlaylari OyunOlayi[]

  @@index([durum])
  @@index([gizliMi, durum])
  @@map("topluluklar")
}

model ToplulukUyesi {
  id           String       @id @default(uuid())
  oyuncuId     String
  toplulukId   String
  rol          UyeRolu      @default(OYUNCU)
  durum        UyeDurumu    @default(AKTIF)
  afkTurSayisi Int          @default(0)
  katildiAt    DateTime     @default(now())
  ayrildiAt    DateTime?

  oyuncu       Oyuncu       @relation(fields: [oyuncuId], references: [id])
  topluluk     Topluluk     @relation(fields: [toplulukId], references: [id], onDelete: Cascade)

  @@unique([oyuncuId, toplulukId])
  @@index([toplulukId, durum])
  @@map("topluluk_uyeleri")
}

// ============ OYUN DURUMU ============

model OyunDurumu {
  id              String      @id @default(uuid())
  toplulukId      String      @unique

  // Mevcut durum
  asama           OyunAsamasi @default(LOBI)
  mevcutTur       Int         @default(0)
  toplamTur       Int         @default(6)
  asamaBitisAt    DateTime?

  // Kaynaklar
  hazine          Int         @default(1000)
  refah           Int         @default(60)
  istikrar        Int         @default(60)
  altyapi         Int         @default(50)

  // Topluluk saÄŸlÄ±ÄŸÄ±
  toplulukSagligi Int         @default(60)

  // SonuÃ§
  sonuc           OyunSonucu?

  topluluk        Topluluk    @relation(fields: [toplulukId], references: [id], onDelete: Cascade)

  @@map("oyun_durumlari")
}

model Tur {
  id          String   @id @default(uuid())
  toplulukId  String
  turNumarasi Int

  // Tur baÅŸÄ±nda kaynak snapshot'Ä±
  basHazine       Int
  basRefah        Int
  basIstikrar     Int
  basAltyapi      Int

  // Olay bilgisi
  olayId      String?  // Olay kataloÄŸuna referans
  olayVerisi  Json?    // Olay verisi snapshot

  // SonuÃ§
  kazananOneriId   String?
  uygulananSonuc   Json?

  basladiAt   DateTime @default(now())
  bittiAt     DateTime?

  topluluk    Topluluk @relation(fields: [toplulukId], references: [id], onDelete: Cascade)
  oneriler    Oneri[]
  olaylar     OyunOlayi[]

  @@unique([toplulukId, turNumarasi])
  @@index([toplulukId])
  @@map("turlar")
}

// ============ OYUN TEKRARI ============

model OyunOlayi {
  id          String        @id @default(uuid())
  toplulukId  String
  turId       String?
  turNumarasi Int?

  tip         OlayTipi
  veri        Json          // Olay detaylarÄ±

  // Kaynak durumu snapshot'Ä±
  hazine      Int?
  refah       Int?
  istikrar    Int?
  altyapi     Int?

  olusturuldu DateTime      @default(now())

  topluluk    Topluluk      @relation(fields: [toplulukId], references: [id], onDelete: Cascade)
  tur         Tur?          @relation(fields: [turId], references: [id], onDelete: Cascade)

  @@index([toplulukId, olusturuldu])
  @@index([turId])
  @@map("oyun_olaylari")
}

enum OlayTipi {
  OYUN_BASLADI
  TUR_BASLADI
  OLAY_ACILDI
  ONERI_YAPILDI
  OY_KULLANILDI
  OYLAMA_TAMAMLANDI
  TUR_BITTI
  KAYNAK_DEGISTI
  OYUN_BITTI
  OYUNCU_KATILDI
  OYUNCU_AYRILDI

  @@map("olay_tipi")
}

// ============ Ã–NERÄ°LER & OYLAMA ============

model Oneri {
  id          String         @id @default(uuid())
  turId       String
  onericiId   String

  baslik      String
  aciklama    String
  eylemler    Json           // OneriEylemi[]

  durum       OneriDurumu    @default(OYLAMADA)

  // Oy sayÄ±mlarÄ± (hÄ±z iÃ§in denormalize)
  evetOylari    Int          @default(0)
  hayirOylari   Int          @default(0)
  cekimserOylar Int          @default(0)

  olusturuldu DateTime       @default(now())
  sonuclandi  DateTime?

  tur         Tur            @relation(fields: [turId], references: [id], onDelete: Cascade)
  onerici     Oyuncu         @relation(fields: [onericiId], references: [id])
  oylar       Oy[]

  @@index([turId, durum])
  @@map("oneriler")
}

model Oy {
  id         String     @id @default(uuid())
  oneriId    String
  oyuncuId   String
  secim      OySecimi
  gerekce    String?
  otomatikMi Boolean    @default(false)
  oylandiAt  DateTime   @default(now())

  oneri      Oneri      @relation(fields: [oneriId], references: [id], onDelete: Cascade)
  oyuncu     Oyuncu     @relation(fields: [oyuncuId], references: [id])

  @@unique([oneriId, oyuncuId])
  @@map("oylar")
}

// ============ BÄ°LDÄ°RÄ°MLER ============

model Bildirim {
  id            String         @id @default(uuid())
  oyuncuId      String
  tip           BildirimTipi
  baslik        String
  icerik        String
  link          String?
  okundu        Boolean        @default(false)
  olusturuldu   DateTime       @default(now())

  oyuncu        Oyuncu         @relation(fields: [oyuncuId], references: [id], onDelete: Cascade)

  @@index([oyuncuId, okundu])
  @@index([olusturuldu])
  @@map("bildirimler")
}

// ============ SOHBET ============

model Mesaj {
  id          String   @id @default(uuid())
  toplulukId  String
  oyuncuId    String
  icerik      String

  // Opsiyonel baÄŸlam
  turNumarasi Int?
  oneriId     String?

  olusturuldu DateTime @default(now())

  topluluk    Topluluk @relation(fields: [toplulukId], references: [id], onDelete: Cascade)
  oyuncu      Oyuncu   @relation(fields: [oyuncuId], references: [id])
  reaksiyonlar MesajReaksiyon[]

  @@index([toplulukId, olusturuldu])
  @@map("mesajlar")
}

// ============ ENUM'LAR ============

enum ToplulukDurumu {
  // Lobi State Machine
  BEKLEME         // WAITING - 4 oyuncu bekliyor
  HAZIR           // READY - 4+ oyuncu var, host baÅŸlatabilir
  GERI_SAYIM      // COUNTDOWN - 30sn geri sayÄ±m
  BOT_DOLDURMA    // BOT_FILLING - Eksik oyuncular bot ile tamamlanÄ±yor

  // Eski enum'lar (backward compatibility)
  LOBI            // Eski: Lobi durumunda (BEKLEME + HAZIR olarak kullanÄ±lÄ±yordu)
  DEVAM_EDIYOR    // IN_GAME - Oyun devam ediyor
  TAMAMLANDI      // FINISHED - Oyun tamamlandÄ±
  TERK_EDILDI     // ABANDONED - TÃ¼m oyuncular ayrÄ±ldÄ±

  @@map("topluluk_durumu")
}

enum OyunModu {
  NORMAL        // Standart oyun (6 tur, 2 dk)
  HIZLI         // HÄ±zlÄ± oyun (4 tur, 1 dk)
  UZUN          // Uzun oyun (10 tur, 3 dk)
  MARATON       // Maraton (15 tur, 5 dk)
  EGITIM        // EÄŸitim modu (3 tur, sÄ±nÄ±rsÄ±z sÃ¼re)
  OZEL          // Ã–zel ayarlar

  @@map("oyun_modu")
}

enum UyeRolu {
  KURUCU
  OYUNCU

  @@map("uye_rolu")
}

enum UyeDurumu {
  AKTIF
  AFK
  AYRILDI
  ATILDI

  @@map("uye_durumu")
}

enum OyunAsamasi {
  // Round State Machine (spec'e uygun)
  OLAY_GOSTERILDI   // EVENT_REVEALED - Olay aÃ§Ä±klandÄ± (5sn okuma)
  ONERI_ACIK        // PROPOSAL_OPEN - Ã–neri aÅŸamasÄ± (60sn)
  OYLAMA_ACIK       // VOTING_OPEN - Oylama aÅŸamasÄ± (30sn)
  HESAPLAMA         // RESOLVING - Tie-break ve kaynak hesaplama (~2sn)
  SONUCLAR          // RESULTS_PUBLISHED - SonuÃ§lar gÃ¶sterildi (5sn)
  TUR_KAPANDI       // ROUND_CLOSED - Tur kapandÄ±

  // Eski enum'lar (backward compatibility)
  LOBI              // Lobide
  TUR_BASI          // Tur baÅŸlangÄ±cÄ±
  OLAY_ACILISI      // Olay aÃ§Ä±lÄ±ÅŸÄ± (eski)
  TARTISMA          // TartÄ±ÅŸma (eski)
  OYLAMA            // Oylama (eski)
  TUR_SONU          // Tur sonu (eski)
  OYUN_SONU         // Oyun bitti
  SONUC             // SonuÃ§ ekranÄ±

  @@map("oyun_asamasi")
}

enum OyunSonucu {
  // Spec'e uygun 5 sonuÃ§ (min ve ortalama bazlÄ±)
  PARLADI         // TÃ¼m kaynaklar >= 70, Ã§arpan: x1.5
  GELISTI         // min >= 45 VE ortalama >= 60, Ã§arpan: x1.25
  DURAGAN         // min >= 25 VE ortalama 40-60, Ã§arpan: x1.0
  GERILEDI        // min < 25 VEYA ortalama < 40, Ã§arpan: x0.75
  COKTU           // Herhangi kaynak 0'a dÃ¼ÅŸtÃ¼ (erken bitiÅŸ), Ã§arpan: x0.5

  // Eski enum'lar (backward compatibility)
  HAYATTA_KALDI   // Eski (DURAGAN ile eÅŸleÅŸir)
  ZORLANDI        // Eski (GERILEDI ile eÅŸleÅŸir)

  @@map("oyun_sonucu")
}

enum OneriDurumu {
  OYLAMADA
  GECTI
  REDDEDILDI
  SURESI_DOLDU

  @@map("oneri_durumu")
}

enum OySecimi {
  EVET
  HAYIR
  CEKIMSER

  @@map("oy_secimi")
}

// ============ YETKÄ°LENDÄ°RME ENUM'LARI ============

enum SistemRolu {
  ADMIN
  MODERATOR
  KULLANICI

  @@map("sistem_rolu")
}

enum HesapDurumu {
  AKTIF
  BANLANDI
  ASKIDA
  SILINDI

  @@map("hesap_durumu")
}

enum BanTipi {
  GECICI
  KALICI

  @@map("ban_tipi")
}

enum ModeasyonTipi {
  KULLANICI_BAN
  KULLANICI_UNBAN
  KULLANICI_ASKIYA_AL
  KULLANICI_AKTIFLES
  TOPLULUK_SIL
  TOPLULUK_DONDUR
  MESAJ_SIL
  ROL_DEGISTIR
  DUYURU_OLUSTUR
  DUYURU_GUNCELLE
  DUYURU_SIL

  @@map("moderasyon_tipi")
}

enum BildirimTipi {
  OYUN_BASLADI
  OYUN_BITTI
  TUR_BASLADI
  OYLAMA_BASLADI
  ONERI_KABUL_EDILDI
  ONERI_REDDEDILDI
  TOPLULUGA_DAVET
  TOPLULUKTAN_ATILDI
  YENI_MESAJ
  SISTEM
  BASARIM_KAZANILDI

  @@map("bildirim_tipi")
}

// ============ BAÅžARIMLAR ============

model Basarim {
  id          String        @id @default(uuid())
  kod         String        @unique  // Unique identifier like "FIRST_WIN", "VOTE_100"
  isim        String
  aciklama    String
  ikon        String        // Emoji or icon name
  kategori    BasarimKategori
  nadirlik    BasarimNadirlik @default(YAYGIN)

  // KoÅŸullar
  kosulTipi   String        // "oyun_sayisi", "oylama_sayisi", "oneri_sayisi", etc.
  kosulDeger  Int           // Hedef deÄŸer

  gizliMi     Boolean       @default(false)  // SÃ¼rpriz baÅŸarÄ±mlar
  aktifMi     Boolean       @default(true)

  olusturuldu DateTime      @default(now())

  kazananlar  KazanilanBasarim[]

  @@index([kategori])
  @@index([aktifMi])
  @@map("basarimlar")
}

model KazanilanBasarim {
  id          String    @id @default(uuid())
  oyuncuId    String
  basarimId   String
  kazanildiAt DateTime  @default(now())

  oyuncu      Oyuncu    @relation(fields: [oyuncuId], references: [id], onDelete: Cascade)
  basarim     Basarim   @relation(fields: [basarimId], references: [id], onDelete: Cascade)

  @@unique([oyuncuId, basarimId])
  @@index([oyuncuId])
  @@index([basarimId])
  @@map("kazanilan_basarimlar")
}

enum BasarimKategori {
  OYUN        // Oyun tamamlama ile ilgili
  OYLAMA      // Oylama ile ilgili
  ONERI       // Ã–neri yapma ile ilgili
  SOSYAL      // Sosyal aktiviteler
  LIDERLIK    // Liderlik baÅŸarÄ±mlarÄ±
  OZEL        // Ã–zel/nadir baÅŸarÄ±mlar

  @@map("basarim_kategori")
}

enum BasarimNadirlik {
  YAYGIN      // Common - %50+ oyuncuda
  SEYREK      // Uncommon - %20-50
  NADIR       // Rare - %5-20
  EFSANEVI    // Legendary - %1-5
  MITIK       // Mythic - <%1

  @@map("basarim_nadirlik")
}

// ============ TURNUVALAR ============

model Turnuva {
  id          String        @id @default(uuid())
  isim        String
  aciklama    String?

  // Turnuva ayarlari
  maxKatilimci    Int       @default(16)
  minKatilimci    Int       @default(4)
  oyunBasinaOyuncu Int      @default(4)  // Her macta kac oyuncu

  durum       TurnuvaDurumu @default(KAYIT_ACIK)

  // Tarihler
  kayitBaslangic  DateTime  @default(now())
  kayitBitis      DateTime
  baslamaZamani   DateTime?
  bitisZamani     DateTime?

  olusturanId     String
  olusturuldu     DateTime  @default(now())
  guncellendi     DateTime  @updatedAt

  // Iliskiler
  katilimcilar    TurnuvaKatilimci[]
  maclar          TurnuvaMac[]

  @@index([durum])
  @@index([kayitBitis])
  @@map("turnuvalar")
}

model TurnuvaKatilimci {
  id          String    @id @default(uuid())
  turnuvaId   String
  oyuncuId    String

  puan        Int       @default(0)
  kazanilanMac Int      @default(0)
  kayipMac    Int       @default(0)
  sira        Int?      // Final sirasi

  katildiAt   DateTime  @default(now())
  elendiAt    DateTime?

  turnuva     Turnuva   @relation(fields: [turnuvaId], references: [id], onDelete: Cascade)
  oyuncu      Oyuncu    @relation(fields: [oyuncuId], references: [id], onDelete: Cascade)

  @@unique([turnuvaId, oyuncuId])
  @@index([turnuvaId])
  @@index([oyuncuId])
  @@map("turnuva_katilimcilari")
}

model TurnuvaMac {
  id          String    @id @default(uuid())
  turnuvaId   String
  turNumarasi Int       // 1, 2, 3... (eleme turlari)
  macNumarasi Int       // O turdaki mac sirasi

  toplulukId  String?   // Oynanan oyunun toplulugu
  durum       MacDurumu @default(BEKLIYOR)

  // Mac sonucu
  kazananId   String?   // Kazanan oyuncu

  basladiAt   DateTime?
  bittiAt     DateTime?

  turnuva     Turnuva   @relation(fields: [turnuvaId], references: [id], onDelete: Cascade)

  @@index([turnuvaId, turNumarasi])
  @@map("turnuva_maclari")
}

enum TurnuvaDurumu {
  KAYIT_ACIK
  KAYIT_KAPALI
  DEVAM_EDIYOR
  TAMAMLANDI
  IPTAL

  @@map("turnuva_durumu")
}

enum MacDurumu {
  BEKLIYOR
  DEVAM_EDIYOR
  TAMAMLANDI
  IPTAL

  @@map("mac_durumu")
}

// ============ ARKADASLIK ============

model Arkadaslik {
  id          String            @id @default(uuid())
  gonderenId  String
  alanId      String

  durum       ArkadaslikDurumu  @default(BEKLIYOR)

  olusturuldu DateTime          @default(now())
  guncellendi DateTime          @updatedAt
  yanitlandiAt DateTime?

  gonderen    Oyuncu            @relation("GonderenOyuncu", fields: [gonderenId], references: [id], onDelete: Cascade)
  alan        Oyuncu            @relation("AlanOyuncu", fields: [alanId], references: [id], onDelete: Cascade)

  @@unique([gonderenId, alanId])
  @@index([gonderenId])
  @@index([alanId])
  @@index([durum])
  @@map("arkadasliklar")
}

enum ArkadaslikDurumu {
  BEKLIYOR
  KABUL_EDILDI
  REDDEDILDI
  ENGELLENDI

  @@map("arkadaslik_durumu")
}

// ============ SISTEM DUYURULARI ============

model SistemDuyurusu {
  id          String          @id @default(uuid())
  baslik      String
  icerik      String
  tip         DuyuruTipi      @default(BILGI)
  aktif       Boolean         @default(true)

  baslangic   DateTime        @default(now())
  bitis       DateTime?       // null = sÃ¼resiz

  olusturanId String
  olusturuldu DateTime        @default(now())
  guncellendi DateTime        @updatedAt

  @@index([aktif, baslangic, bitis])
  @@map("sistem_duyurulari")
}

enum DuyuruTipi {
  BILGI       // Genel bilgilendirme
  UYARI       // Dikkat Ã§eken uyarÄ±
  ONEMLI      // Ã–nemli duyuru
  BAKIM       // BakÄ±m duyurusu
  ETKINLIK    // Etkinlik/Event

  @@map("duyuru_tipi")
}

// ============ PREMÄ°UM SÄ°STEMÄ° ============

model PremiumUyelik {
  id            String          @id @default(uuid())
  oyuncuId      String

  // Ãœyelik tipi
  tip           PremiumTip

  // SÃ¼re
  baslangic     DateTime        @default(now())
  bitis         DateTime

  // Ã–deme bilgileri
  odemeTutari   Float
  odemeTarihi   DateTime        @default(now())
  odemeYontemi  String?         // "kredi_karti", "paypal", "crypto"
  odemeRefId    String?         // Ã–deme referans ID

  // Durum
  aktif         Boolean         @default(true)
  iptalEdildi   Boolean         @default(false)
  iptalTarihi   DateTime?

  olusturuldu   DateTime        @default(now())
  guncellendi   DateTime        @updatedAt

  oyuncu        Oyuncu          @relation(fields: [oyuncuId], references: [id])

  @@index([oyuncuId])
  @@index([aktif, bitis])
  @@map("premium_uyelikler")
}

// Premium hediye/promosyon kodlarÄ±
model PromosyonKodu {
  id            String          @id @default(uuid())
  kod           String          @unique

  // Ne veriyor
  premiumTip    PremiumTip
  sureSaat      Int             // KaÃ§ saatlik premium veriyor

  // KullanÄ±m
  maxKullanim   Int             @default(1)
  kullanilanSayi Int            @default(0)

  // GeÃ§erlilik
  gecerliBaslangic DateTime     @default(now())
  gecerliBitis     DateTime?
  aktif         Boolean         @default(true)

  olusturuldu   DateTime        @default(now())
  olusturanId   String?

  kullanimlar   PromosyonKullanimi[]

  @@map("promosyon_kodlari")
}

model PromosyonKullanimi {
  id            String          @id @default(uuid())
  promosyonKodId String
  oyuncuId      String
  kullanimTarihi DateTime       @default(now())

  promosyonKodu PromosyonKodu   @relation(fields: [promosyonKodId], references: [id])

  @@unique([promosyonKodId, oyuncuId]) // AynÄ± kiÅŸi aynÄ± kodu 1 kez kullanabilir
  @@map("promosyon_kullanimlari")
}

// Premium tipleri
enum PremiumTip {
  VIP       // 1 aylÄ±k temel premium
  GOLD      // 3 aylÄ±k premium + ekstra Ã¶zellikler
  DIAMOND   // 1 yÄ±llÄ±k premium + tÃ¼m Ã¶zellikler
  LIFETIME  // Ã–mÃ¼r boyu premium

  @@map("premium_tip")
}

// Premium avantajlarÄ± (statik, kod tarafÄ±nda tanÄ±mlÄ±)
// VIP:
//   - 1.2x puan Ã§arpanÄ±
//   - Ã–zel VIP rozeti
//   - Ã–ncelikli eÅŸleÅŸtirme
//   - ReklamsÄ±z deneyim
//
// GOLD:
//   - 1.5x puan Ã§arpanÄ±
//   - Ã–zel GOLD rozeti
//   - Ã–ncelikli eÅŸleÅŸtirme
//   - ReklamsÄ±z deneyim
//   - Ã–zel oyun modlarÄ±
//   - DetaylÄ± istatistikler
//
// DIAMOND:
//   - 2x puan Ã§arpanÄ±
//   - Ã–zel DIAMOND rozeti
//   - Ã–ncelikli eÅŸleÅŸtirme (en yÃ¼ksek)
//   - ReklamsÄ±z deneyim
//   - TÃ¼m Ã¶zel oyun modlarÄ±
//   - TÃ¼m detaylÄ± istatistikler
//   - Ã–zel avatar Ã§erÃ§eveleri
//   - Beta Ã¶zelliklere eriÅŸim
//
// LIFETIME:
//   - DIAMOND ile aynÄ± avantajlar
//   - Ã–zel "DestekÃ§i" rozeti
//   - Founder badge

// ============ GÃ–REV SÄ°STEMÄ° ============

model Gorev {
  id            String          @id @default(uuid())
  kod           String          @unique  // GUNLUK_3_OYUN, HAFTALIK_10_OYUN vb.
  tip           GorevTipi
  baslik        String
  aciklama      String

  // Gereksinimler
  hedefDeger    Int             // KaÃ§ kez yapÄ±lmalÄ±
  hedefTip      String          // OYUN_OYNA, OYUN_KAZAN, PUAN_KAZAN vb.

  // Ã–dÃ¼ller
  altinOdulu    Int             @default(0)
  puanOdulu     Int             @default(0)
  xpOdulu       Int             @default(0)
  rozetOdulu    String?         // Rozet kodu

  // Aktiflik
  aktif         Boolean         @default(true)
  tekrarlanabilir Boolean       @default(true)

  // SÃ¼re (gÃ¼nlÃ¼k/haftalÄ±k iÃ§in)
  yenilemeSaati Int?            // 0-23 arasÄ± saat

  olusturuldu   DateTime        @default(now())

  ilerlemeler   GorevIlerleme[]

  @@map("gorevler")
}

model GorevIlerleme {
  id            String          @id @default(uuid())
  gorevId       String
  oyuncuId      String

  mevcutDeger   Int             @default(0)
  tamamlandi    Boolean         @default(false)
  tamamlandiAt  DateTime?
  odulAlindi    Boolean         @default(false)

  // Periyodik gÃ¶revler iÃ§in
  periyotBaslangic DateTime     @default(now())

  olusturuldu   DateTime        @default(now())
  guncellendi   DateTime        @updatedAt

  gorev         Gorev           @relation(fields: [gorevId], references: [id])

  @@unique([gorevId, oyuncuId, periyotBaslangic])
  @@index([oyuncuId])
  @@map("gorev_ilerlemeleri")
}

enum GorevTipi {
  GUNLUK
  HAFTALIK
  AYLIK
  OZEL        // Tek seferlik Ã¶zel gÃ¶revler
  SEZONLUK

  @@map("gorev_tipi")
}

// ============ SANAL PARA SÄ°STEMÄ° ============

model AltinCuzdani {
  id            String          @id @default(uuid())
  oyuncuId      String          @unique
  bakiye        Int             @default(0)
  toplamKazanilan Int           @default(0)
  toplamHarcanan  Int           @default(0)

  olusturuldu   DateTime        @default(now())
  guncellendi   DateTime        @updatedAt

  islemler      AltinIslem[]

  @@map("altin_cuzdanlari")
}

model AltinIslem {
  id            String          @id @default(uuid())
  cuzdanId      String

  miktar        Int             // Pozitif = kazanÃ§, negatif = harcama
  tip           AltinIslemTipi
  aciklama      String?
  referansId    String?         // Ä°lgili gÃ¶rev, satÄ±n alma vb. ID

  olusturuldu   DateTime        @default(now())

  cuzdan        AltinCuzdani    @relation(fields: [cuzdanId], references: [id])

  @@index([cuzdanId])
  @@map("altin_islemleri")
}

enum AltinIslemTipi {
  GOREV_ODULU
  OYUN_ODULU
  GUNLUK_BONUS
  BASARIM_ODULU
  SATIN_ALMA      // GerÃ§ek para ile
  HARCAMA         // MaÄŸazadan alÄ±ÅŸveriÅŸ
  HEDIYE_ALINDI
  HEDIYE_GONDERILDI
  ADMIN_EKLEME

  @@map("altin_islem_tipi")
}

// ============ SEZON SÄ°STEMÄ° ============

model Sezon {
  id            String          @id @default(uuid())
  isim          String
  aciklama      String?

  baslangic     DateTime
  bitis         DateTime

  // Ã–dÃ¼ller (JSON formatÄ±nda tier bazlÄ±)
  oduller       Json?           // { "bronz": {...}, "gumus": {...}, "altin": {...} }

  aktif         Boolean         @default(false)

  olusturuldu   DateTime        @default(now())

  katilimcilar  SezonKatilimci[]

  @@map("sezonlar")
}

model SezonKatilimci {
  id            String          @id @default(uuid())
  sezonId       String
  oyuncuId      String

  puan          Int             @default(0)
  seviye        Int             @default(1)
  xp            Int             @default(0)

  // Sezon sonu sÄ±ralama
  sonSira       Int?
  sonTier       String?         // BRONZ, GUMUS, ALTIN, ELMAS
  odulAlindi    Boolean         @default(false)

  olusturuldu   DateTime        @default(now())
  guncellendi   DateTime        @updatedAt

  sezon         Sezon           @relation(fields: [sezonId], references: [id])

  @@unique([sezonId, oyuncuId])
  @@index([oyuncuId])
  @@map("sezon_katilimcilari")
}

// ============ EMOJÄ°/REACTÄ°ON SÄ°STEMÄ° ============

model MesajReaksiyon {
  id            String          @id @default(uuid())
  mesajId       String
  oyuncuId      String
  emoji         String          // ðŸ‘, â¤ï¸, ðŸ˜‚, ðŸ˜®, ðŸ˜¢, ðŸ˜¡

  olusturuldu   DateTime        @default(now())

  mesaj         Mesaj           @relation(fields: [mesajId], references: [id], onDelete: Cascade)
  oyuncu        Oyuncu          @relation(fields: [oyuncuId], references: [id], onDelete: Cascade)

  @@unique([mesajId, oyuncuId, emoji])
  @@index([mesajId])
  @@map("mesaj_reaksiyonlari")
}

// ============ AVATAR SÄ°STEMÄ° ============

model AvatarOgesi {
  id            String          @id @default(uuid())
  tip           AvatarOgeTipi
  kod           String          @unique
  isim          String

  // GÃ¶rsel
  gorselUrl     String
  onizlemeUrl   String?

  // Elde etme
  varsayilan    Boolean         @default(false)
  satilikMi     Boolean         @default(false)
  fiyatAltin    Int?
  fiyatGercek   Float?

  // Ã–zel elde etme
  basarimKodu   String?         // Bu baÅŸarÄ±mla aÃ§Ä±lÄ±r
  premiumTip    String?         // Bu premium ile aÃ§Ä±lÄ±r
  sezonOdulu    Boolean         @default(false)

  nadirlik      NadirlikSeviyesi @default(YAYGIN)

  aktif         Boolean         @default(true)
  olusturuldu   DateTime        @default(now())

  sahipler      AvatarSahipligi[]

  @@map("avatar_ogeleri")
}

model AvatarSahipligi {
  id            String          @id @default(uuid())
  oyuncuId      String
  avatarOgeId   String

  edinmeTarihi  DateTime        @default(now())
  edinmeYontemi String          // SATIN_ALMA, BASARIM, PREMIUM, SEZON, HEDIYE

  avatarOge     AvatarOgesi     @relation(fields: [avatarOgeId], references: [id])

  @@unique([oyuncuId, avatarOgeId])
  @@index([oyuncuId])
  @@map("avatar_sahiplikleri")
}

model OyuncuAvatar {
  id            String          @id @default(uuid())
  oyuncuId      String          @unique

  // Aktif avatar Ã¶geleri
  cerceve       String?         // Avatar Ã§erÃ§eve kodu
  arkaplan      String?         // Profil arkaplan kodu
  rozet         String?         // GÃ¶sterilen rozet kodu
  baslik        String?         // Unvan
  tema          String?         // Profil tema kodu

  guncellendi   DateTime        @updatedAt

  @@map("oyuncu_avatarlari")
}

enum AvatarOgeTipi {
  CERCEVE       // Avatar Ã§erÃ§evesi
  ARKAPLAN      // Profil arkaplanÄ±
  ROZET         // GÃ¶sterilebilir rozet
  BASLIK        // Unvan ("Efsane", "Stratejist" vb.)
  TEMA          // Profil temasÄ±
  EMOJI_PAKETI  // Ã–zel emoji paketi

  @@map("avatar_oge_tipi")
}

enum NadirlikSeviyesi {
  YAYGIN        // Common
  NADIR         // Rare
  EPIK          // Epic
  EFSANEVI      // Legendary

  @@map("nadirlik_seviyesi")
}

// ============ HEDÄ°YE SÄ°STEMÄ° ============

model Hediye {
  id            String          @id @default(uuid())
  gonderenId    String
  alanId        String

  tip           HediyeTipi
  deger         Int             // AltÄ±n miktarÄ± veya premium gÃ¼n sayÄ±sÄ±
  mesaj         String?

  kabulEdildi   Boolean         @default(false)
  kabulTarihi   DateTime?

  olusturuldu   DateTime        @default(now())

  @@index([gonderenId])
  @@index([alanId])
  @@map("hediyeler")
}

enum HediyeTipi {
  ALTIN
  PREMIUM_GUN
  AVATAR_OGESI

  @@map("hediye_tipi")
}
